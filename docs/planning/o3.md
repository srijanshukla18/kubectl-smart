# kubectl-smart — New Learnings Captured by o3

_This document records fresh insights generated during the latest planning session. These ideas were **not** present in any existing *.md files at the time of writing._

## 1. Product-Tier Framework

| Tier | Capability | Status | Purpose |
|------|------------|--------|---------|
| **1** | Live Debugger (analyze / describe / deps / events) | GA | Fast noise-to-signal during incidents |
| **2** | Predictive Prevention (cert, disk, memory, CPU, node capacity) | Beta (flag `--experimental-predict`) | Stop boring outages before they fire alerts |
| **3** | Operational Memory & Patterns (timeline, pattern mining) | Alpha | Preserve change history & uncover recurring rhythms |
| **R&D** | Simulation & Deep Causality | Research | Long-term moon-shot, no roadmap commitment |

## 2. Feature-Flag Strategy

* `--experimental-predict` enables Tier-2 predictors.
* Timeline & pattern commands guarded by `--alpha-memory` to avoid destabilising GA path.
* Flags are discoverable via `kubectl smart info features`.

## 3. Metrics Strategy (Vendor-Neutral)

1. **Default path** – query `metrics-server` for CPU/memory where available.
2. **Auto-detect Prometheus** – if service `kube-prometheus` exists or env `SMART_PROM_URL` set, switch to PromQL for richer data.
3. **PVC usage** – pull `kubelet_volume_stats_used_bytes`; gracefully skip if metric absent.

> Goal: 100 % functionality on vanilla clusters; richer accuracy when Prometheus present.

## 4. Operational Memory MVP (Deterministic)

* **Event Source**:  `kubectl --watch -A events` + periodic `kubectl get` diffs.
* **Storage**: lightweight **LevelDB** at `~/.kube/smart-memory` (rotates after 14 days).
* **Query**: `kubectl smart timeline <resource> --since=1h` returns deterministic change log; *no* causality inference.

## 5. Business-Impact Annotation Convention

```
metadata:
  labels:
    ops.kubectl-smart.io/criticality: high | medium | low
```

CLI helper:
```
kubectl smart label deployment/api --criticality high
```

Used only for impact weighting; zero guesses if label absent.

## 6. Packaging & Distribution Roadmap

1. **Krew** – publish manifest for 1-line install.
2. **PyInstaller** – ship static binaries for Linux & macOS to remove Python dependency.
3. **Homebrew Tap** – wrap PyInstaller artifacts for macOS users.

## 7. Test & Validation Enhancements

* Embed Chaos-tester into CI (kind/k3d) to gate PRs.
* Add synthetic Prometheus data generator to unit-test predictor math offline.

## 8. Success Metrics per Tier

| Tier | KPI | Target |
|------|-----|--------|
| 1 | MTTR reduction in drills | ≥ 30 % |
| 2 | Cert/PVC incident catch rate ≥24 h early | ≥ 80 % (≤ 5 % false-positive) |
| 3 | "Timeline surfaced aha" moments in user interviews | ≥ 1 per incident review |

## 9. UX Continuity — Training-Wheels Auto-Graduation

* Track successful command runs in local config.
* After 20 "clean" uses, auto-collapse verbose hints unless user adds `--hints`.

---
These learnings refine the vision while anchoring it to pragmatic, testable steps. Future PRs should reference this file when implementing the described improvements. 